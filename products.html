<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>HyperBuy - S·∫£n ph·∫©m</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="css/style.css" />
</head>

<body>
  <!-- ===== HEADER ===== -->
<header class="main-header">
    <nav id="main-navbar" class="nav-elevated">
      <div class="container nav-container">
        <div class="header-left">
          <a href="index.html" class="nav-brand">‚ö° HyperBuy</a>
        </div>

        <ul id="main-nav" class="nav-links">
          <li><a href="index.html" id="nav-home" class="nav-link">Trang Ch·ªß</a></li>
          <li><a href="products.html" id="nav-products" class="nav-link">S·∫£n Ph·∫©m</a></li>
          
          <li id="nav-profile" style="display:none;"><a href="profile.html" class="nav-link">H·ªì S∆°</a></li>
          <li id="nav-my-orders" style="display:none;"><a href="my-orders.html" class="nav-link nav-active">ƒê∆°n H√†ng</a></li>

          <!-- ‚≠ê QU·∫¢N TR·ªä (ID CHU·∫®N) -->
          <li id="nav-admin-dashboard-li" style="display:none;"><a href="admin.html" class="nav-link">Qu·∫£n Tr·ªã</a></li>
          <li><a href="minigame.html" class="nav-link">MiniGame</a></li>
          <li id="nav-cart-link-li">
            <a href="cart.html" class="nav-link">
              <i class="fas fa-shopping-cart"></i> Gi·ªè H√†ng
              <span class="cart-item-count-nav" style="display:none;"></span>
            </a>
          </li>

          <!-- üîî TH√îNG B√ÅO -->
          <li id="nav-notification-bell" style="display:none; position:relative;">
              <a href="#" id="notification-bell-link" class="nav-link nav-link-bell">
                  <i class="fas fa-bell"></i>
                  <span id="notification-count" class="notification-badge" style="display:none;"></span>
              </a>

              <div id="notification-dropdown" class="notification-list-dropdown">
                  <div class="notification-dropdown-header">Th√¥ng b√°o</div>
                  <ul id="notification-list-items" class="notification-list">
                      <li><a class="dropdown-item-notif">Kh√¥ng c√≥ th√¥ng b√°o n√†o.</a></li>
                  </ul>
                  <div class="notification-dropdown-footer">
                      <a href="notifications.html" class="view-all-notifications">Xem t·∫•t c·∫£</a>
                  </div>
              </div>
          </li>

          <li id="nav-login"><a href="login.html" class="nav-link">ƒêƒÉng Nh·∫≠p</a></li>
          <li id="nav-register"><a href="register.html" class="nav-link">ƒêƒÉng K√Ω</a></li>
        </ul>
      </div>
    </nav>
</header>

  <!-- ===== MAIN CONTENT ===== -->
  <main class="container product-page">
    <section class="filter-section">
      <h2>üîç T√¨m ki·∫øm & L·ªçc S·∫£n ph·∫©m</h2>
      <form id="product-filter-form">
        <label for="name">T√™n s·∫£n ph·∫©m:</label>
        <input type="text" id="name" name="name" placeholder="Nh·∫≠p t·ª´ kh√≥a..." />

        <label for="category">Danh m·ª•c:</label>
        <select id="category" name="category">
          <option value="">-- T·∫•t c·∫£ danh m·ª•c --</option>
        </select>

        <label>Kho·∫£ng gi√° (VND):</label>
        <div class="price-filter">
          <input type="number" id="minPrice" placeholder="T·ª´" />
          <span>-</span>
          <input type="number" id="maxPrice" placeholder="ƒê·∫øn" />
        </div>

        <label for="sort">S·∫Øp x·∫øp:</label>
        <select id="sort">
          <option value="">M·∫∑c ƒë·ªãnh</option>
          <option value="priceAsc">Gi√° tƒÉng d·∫ßn</option>
          <option value="priceDesc">Gi√° gi·∫£m d·∫ßn</option>
        </select>

        <div class="filter-buttons">
          <button type="submit" class="btn-primary">L·ªçc S·∫£n Ph·∫©m</button>
          <button type="reset" class="btn-secondary">Reset B·ªô L·ªçc</button>
        </div>
      </form>
    </section>

    <section id="product-results">
      <h2>T·∫•t c·∫£ s·∫£n ph·∫©m</h2>
      <div id="product-list" class="product-grid">
        <p>ƒêang t·∫£i s·∫£n ph·∫©m...</p>
      </div>
    </section>
  </main>

  <!-- ===== FOOTER ===== -->
  <footer>
    <div class="container">
      <p>&copy; <span id="current-year"></span> HyperBuy. M·ªçi quy·ªÅn ƒë∆∞·ª£c b·∫£o l∆∞u.</p>
    </div>
  </footer>

<script src="js/main.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    // 1. Load danh m·ª•c v√†o select #category
    await loadCategoriesAndBuildMap("category");

    // 2. L·∫•y tham s·ªë tr√™n URL
    const urlParams       = new URLSearchParams(window.location.search);
    const nameFromUrl     = urlParams.get("name") || "";
    // üëâ H·ªñ TR·ª¢ C·∫¢ ?category= V√Ä ?categoryId=
    const categoryFromUrl = urlParams.get("category") || urlParams.get("categoryId") || "";
    const minFromUrl      = urlParams.get("minPrice") || "";
    const maxFromUrl      = urlParams.get("maxPrice") || "";
    const sortFromUrl     = urlParams.get("sort") || "";

    const nameInput      = document.getElementById("name");
    const categorySelect = document.getElementById("category");
    const minPriceInput  = document.getElementById("minPrice");
    const maxPriceInput  = document.getElementById("maxPrice");
    const sortSelect     = document.getElementById("sort");

    if (nameInput)      nameInput.value      = nameFromUrl;
    if (categorySelect && categoryFromUrl) categorySelect.value = categoryFromUrl;
    if (minPriceInput)  minPriceInput.value  = minFromUrl;
    if (maxPriceInput)  maxPriceInput.value  = maxFromUrl;
    if (sortSelect && sortFromUrl) sortSelect.value = sortFromUrl;

    // 3. Submit form l·ªçc
    const filterForm = document.getElementById("product-filter-form");
    if (filterForm) {
      filterForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        await fetchProductsByFilters(0);
      });

      filterForm.addEventListener("reset", async (e) => {
        e.preventDefault();
        window.history.replaceState({}, "", window.location.pathname);
        setTimeout(() => fetchProductsByFilters(0), 0);
      });
    }

    // 4. L·∫ßn ƒë·∫ßu v√†o trang ‚áí load theo b·ªô l·ªçc (ho·∫∑c theo category t·ª´ URL)
    await fetchProductsByFilters(0);
  });
</script>
</body>
</html>
